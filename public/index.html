<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload to Docker Container</title>
  <style>
    :root{
      --bg: #ffffff;
      --card: #ffffff;
      --muted: #5b6477;
      --text: #0b1020;
      --brand: #3b82f6;
      --brand-2:#6366f1;
      --ok:#10b981;
      --err:#ef4444;
      --ring: rgba(59,130,246,.45);
      --border: #e5e7eb;
      --table-stripe: #f9fafb;
      --shadow: 0 6px 20px rgba(15,23,42,.08);
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: var(--bg);
      min-height:100vh;
      display:grid; place-items:center; padding:32px;
    }

    .shell{ width:min(1100px, 92vw); }

    .header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px;
    }
    .title{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: 0 8px 24px rgba(59,130,246,.35);
      display:grid; place-items:center; color:white; font-weight:800; letter-spacing:.5px;
    }
    h1{ font-size: clamp(22px, 2.6vw, 30px); margin:0; }
    .subtitle{ color:var(--muted); margin:4px 0 0 0; font-size:14px }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .toolbar{ display:flex; gap:10px; align-items:center; padding:14px; border-bottom:1px solid var(--border); flex-wrap:wrap; }
    .btn{
      appearance:none; border:1px solid var(--border); background:linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,0));
      padding:10px 14px; border-radius:10px; cursor:pointer; color:var(--text); font-weight:600;
      transition: transform .02s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 1px 0 rgba(0,0,0,.04), 0 8px 20px rgba(0,0,0,.08);
    }
    .btn:hover{ border-color:var(--ring); box-shadow: 0 0 0 6px var(--ring), 0 8px 20px rgba(0,0,0,.08); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color: transparent; background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:white; }

    .muted{ color:var(--muted) }

    .uploader{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; padding:18px; 
    }
    @media (max-width: 860px){ .uploader{ grid-template-columns: 1fr; } }

    .dropzone{
      border: 2px dashed var(--border); border-radius: 16px; padding:22px; display:flex; gap:16px; align-items:center; justify-content:center; flex-direction:column; text-align:center;
      background: #fafafa;
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
      min-height: 160px;
    }
    .dropzone.drag{
      border-color: var(--brand); box-shadow: 0 0 0 6px var(--ring);
      background: #eff6ff;
    }
    .dz-title{ font-weight:700; }
    .dz-sub{ font-size: 13px; color:var(--muted) }

    .file-input{ display:none }

    .queue{
      border:1px dashed var(--border); border-radius: 12px; padding:12px; max-height:220px; overflow:auto; background: #fafafa;
    }
    .queue .empty{ color:var(--muted); font-size:14px; text-align:center; padding:20px 6px; }
    .qitem{ display:grid; grid-template-columns: 48px 1fr auto; gap:12px; align-items:center; padding:8px; border-radius:10px; }
    .qitem:not(:last-child){ border-bottom:1px dashed var(--border) }
    .thumb{ width:48px; height:48px; border-radius:10px; background: #f3f4f6; display:grid; place-items:center; overflow:hidden; border:1px solid var(--border); }
    .thumb img{ max-width:100%; max-height:100%; object-fit:cover }
    .name{ font-weight:600; }
    .meta{ font-size:12px; color:var(--muted) }

    .progress{ height:8px; border-radius:999px; background:#e5e7eb; overflow:hidden; margin-top:6px; }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg, var(--brand), var(--brand-2)); transition: width .2s ease; }

    .section-title{ margin: 10px 0 0 0; font-size:14px; letter-spacing:.25px; color:var(--muted); }

    .table-wrap{ padding:0 18px 18px; }
    table{ width:100%; border-collapse: collapse; overflow:hidden; border-radius:12px; border:1px solid var(--border); }
    thead th{ font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); background:#f9fafb; }
    th, td{ text-align:left; padding:12px 14px; border-bottom:1px solid var(--border); }
    tbody tr:nth-child(even){ background: var(--table-stripe); }
    tbody a{ color:var(--brand); text-decoration:none; font-weight:600; }

    .status{ font-size:13px; margin-left:6px; }

    .pill{ padding: 6px 10px; border-radius:999px; border:1px solid var(--border); font-size:12px; color:var(--muted); }

    .footer{ padding:14px 18px; border-top:1px solid var(--border); display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }

    /* toast */
    .toast{ position: fixed; inset:auto 20px 20px auto; background: var(--card); border:1px solid var(--border); color:var(--text); padding:12px 14px; border-radius:12px; box-shadow: var(--shadow); transform: translateY(20px); opacity:0; pointer-events:none; transition: all .25s ease; }
    .toast.show{ opacity:1; transform: translateY(0); pointer-events:auto; }
    .toast.ok{ border-color: rgba(16,185,129,.45) }
    .toast.err{ border-color: rgba(239,68,68,.45) }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <div class="title">
        <div class="logo">UP</div>
        <div>
          <h1>Upload files into the Docker container</h1>
          <p class="subtitle">Files are stored at <code>/app/uploads</code> inside the container.</p>
        </div>
      </div>
      <button class="btn" id="refreshBtn" aria-label="Refresh file list">↻ Refresh</button>
    </div>

    <div class="card">
      <div class="toolbar">
        <label for="fileInput" class="btn">Choose files</label>
        <input type="file" id="fileInput" class="file-input" name="files" multiple />
        <button class="btn primary" id="uploadBtn">Upload</button>
        <span class="status muted" id="status">Idle</span>
        <span class="pill" id="countPill">0 selected</span>
      </div>

      <div class="uploader">
        <div class="dropzone" id="dropzone" tabindex="0" role="button" aria-label="Drop files here or click to select">
          <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 16V8m0 0l-3 3m3-3l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 16.5a4.5 4.5 0 00-4.5-4.5H15A6 6 0 103 12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="dz-title">Drag & drop files here</div>
          <div class="dz-sub">or click to browse — max size depends on server</div>
        </div>

        <div>
          <div class="section-title">Selected files</div>
          <div class="queue" id="queue">
            <div class="empty">No files selected yet.</div>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <div class="section-title">Files in container</div>
        <table id="filesTable" aria-live="polite">
          <thead>
            <tr><th>Name</th><th>Size</th><th>Modified</th><th>Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="footer">
        <span class="muted">Tip: Open files via the link; use <code>Download</code> to save locally.</span>
        <span class="muted" id="lastUpdated">Last updated —</span>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="assertive"></div>

  <script>
    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));

    const fileInput = $('#fileInput');
    const queueEl = $('#queue');
    const countPill = $('#countPill');
    const statusEl = $('#status');
    const lastUpdated = $('#lastUpdated');
    const toast = $('#toast');

    const fmtBytes = (n) => {
      if (n === 0) return '0 B';
      const units = ['B','KB','MB','GB','TB'];
      let i = Math.floor(Math.log(n) / Math.log(1024));
      const v = (n / Math.pow(1024, i));
      return `${v.toFixed(v < 10 ? 1 : 0)} ${units[i]}`;
    };

    const fmtDate = (d) => new Date(d).toLocaleString();

    const showToast = (msg, type = 'ok') => {
      toast.textContent = msg; toast.className = 'toast show ' + type; 
      setTimeout(() => toast.classList.remove('show'), 2400);
    };

    const setQueue = (files) => {
      queueEl.innerHTML = '';
      if (!files.length){
        queueEl.innerHTML = '<div class="empty">No files selected yet.</div>';
        countPill.textContent = '0 selected';
        return;
      }
      files.forEach((f) => {
        const row = document.createElement('div');
        row.className = 'qitem';
        const th = document.createElement('div'); th.className = 'thumb';
        if (f.type.startsWith('image/')){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(f); th.appendChild(img);
        } else {
          th.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M7 3h6l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" stroke="currentColor" stroke-width="1.5"/><path d="M13 3v5h5" stroke="currentColor" stroke-width="1.5"/></svg>';
        }
        const info = document.createElement('div');
        info.innerHTML = `<div class="name">${f.name}</div><div class="meta">${fmtBytes(f.size)} · ${f.type || 'unknown'}</div><div class="progress"><div class="bar" data-name="${encodeURIComponent(f.name)}"></div></div>`;
        const act = document.createElement('div'); act.innerHTML = '<span class="pill">Queued</span>';
        row.append(th, info, act); queueEl.appendChild(row);
      });
      countPill.textContent = files.length + (files.length === 1 ? ' selected' : ' selected');
    };

    // Drag & Drop
    const dz = $('#dropzone');
    ;['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.add('drag'); }));
    ;['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.remove('drag'); }));
    dz.addEventListener('drop', (e)=>{ const files = e.dataTransfer.files; fileInput.files = files; setQueue(files); });
    dz.addEventListener('click', ()=> fileInput.click());

    // Input change
    fileInput.addEventListener('change', (e)=> setQueue(e.target.files));

    // Upload
    const upload = async () => {
      const files = fileInput.files; if (!files.length) { showToast('Please choose at least one file', 'err'); return; }
      const fd = new FormData(); Array.from(files).forEach((f)=> fd.append('files', f));
      statusEl.textContent = 'Uploading…';

      // Use XHR for progress
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');
      xhr.upload.onprogress = (e) => {
        if (!e.lengthComputable) return;
        const pct = Math.round((e.loaded / e.total) * 100);
        $$('.bar').forEach(b => b.style.width = pct + '%');
      };
      xhr.onreadystatechange = () => {
        if (xhr.readyState === 4){
          if (xhr.status >= 200 && xhr.status < 300){
            try { const json = JSON.parse(xhr.responseText); statusEl.textContent = `Uploaded ${json.uploaded?.length ?? 0} file(s).`; showToast('Upload complete'); refresh(); }
            catch{ statusEl.textContent = 'Uploaded.'; showToast('Upload complete'); refresh(); }
          } else { statusEl.textContent = 'Error uploading files.'; showToast('Upload failed', 'err'); }
        }
      };
      xhr.send(fd);
    };

    $('#uploadBtn').addEventListener('click', (e)=>{ e.preventDefault(); upload(); });

    async function refresh(){
      try{
        const res = await fetch('/files');
        if(!res.ok) throw new Error('Failed to fetch file list');
        const data = await res.json();
        const tbody = document.querySelector('#filesTable tbody');
        tbody.innerHTML = '';
        for (const f of data){
          const tr = document.createElement('tr');

          const nameTd = document.createElement('td');
          const link = document.createElement('a'); link.href = `/uploads/${encodeURIComponent(f.name)}`; link.textContent = f.name; link.target = '_blank'; nameTd.appendChild(link);

          const sizeTd = document.createElement('td'); sizeTd.textContent = fmtBytes(f.size || 0);

          const mTd = document.createElement('td'); mTd.textContent = fmtDate(f.mtime);

          const aTd = document.createElement('td');
          const dl = document.createElement('a'); dl.href = `/download/${encodeURIComponent(f.name)}`; dl.textContent = 'Download'; aTd.appendChild(dl);

          tr.append(nameTd, sizeTd, mTd, aTd);
          tbody.appendChild(tr);
        }
        lastUpdated.textContent = 'Last updated — ' + new Date().toLocaleTimeString();
      }catch(e){ showToast('Could not refresh file list', 'err'); }
    }

    $('#refreshBtn').addEventListener('click', ()=> refresh());

    // Initial load
    refresh();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload to Docker Container</title>
  <style>
    :root{
      --bg: #ffffff;
      --card: #ffffff;
      --muted: #5b6477;
      --text: #0b1020;
      --brand: #3b82f6;
      --brand-2:#6366f1;
      --ok:#10b981;
      --err:#ef4444;
      --ring: rgba(59,130,246,.45);
      --border: #e5e7eb;
      --table-stripe: #f9fafb;
      --shadow: 0 6px 20px rgba(15,23,42,.08);
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: var(--bg);
      min-height:100vh;
      display:grid; place-items:center; padding:32px;
    }

    .shell{ width:min(1100px, 92vw); }

    .header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px;
    }
    .title{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: 0 8px 24px rgba(59,130,246,.35);
      display:grid; place-items:center; color:white; font-weight:800; letter-spacing:.5px;
    }
    h1{ font-size: clamp(22px, 2.6vw, 30px); margin:0; }
    .subtitle{ color:var(--muted); margin:4px 0 0 0; font-size:14px }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .toolbar{ display:flex; gap:10px; align-items:center; padding:14px; border-bottom:1px solid var(--border); flex-wrap:wrap; }
    .btn{
      appearance:none; border:1px solid var(--border); background:linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,0));
      padding:10px 14px; border-radius:10px; cursor:pointer; color:var(--text); font-weight:600;
      transition: transform .02s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 1px 0 rgba(0,0,0,.04), 0 8px 20px rgba(0,0,0,.08);
    }
    .btn:hover{ border-color:var(--ring); box-shadow: 0 0 0 6px var(--ring), 0 8px 20px rgba(0,0,0,.08); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color: transparent; background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:white; }

    .muted{ color:var(--muted) }

    .uploader{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; padding:18px; 
    }
    @media (max-width: 860px){ .uploader{ grid-template-columns: 1fr; } }

    .dropzone{
      border: 2px dashed var(--border); border-radius: 16px; padding:22px; display:flex; gap:16px; align-items:center; justify-content:center; flex-direction:column; text-align:center;
      background: #fafafa;
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
      min-height: 160px;
    }
    .dropzone.drag{
      border-color: var(--brand); box-shadow: 0 0 0 6px var(--ring);
      background: #eff6ff;
    }
    .dz-title{ font-weight:700; }
    .dz-sub{ font-size: 13px; color:var(--muted) }

    .file-input{ display:none }

    .queue{
      border:1px dashed var(--border); border-radius: 12px; padding:12px; max-height:220px; overflow:auto; background: #fafafa;
    }
    .queue .empty{ color:var(--muted); font-size:14px; text-align:center; padding:20px 6px; }
    .qitem{ display:grid; grid-template-columns: 48px 1fr auto; gap:12px; align-items:center; padding:8px; border-radius:10px; }
    .qitem:not(:last-child){ border-bottom:1px dashed var(--border) }
    .thumb{ width:48px; height:48px; border-radius:10px; background: #f3f4f6; display:grid; place-items:center; overflow:hidden; border:1px solid var(--border); }
    .thumb img{ max-width:100%; max-height:100%; object-fit:cover }
    .name{ font-weight:600; }
    .meta{ font-size:12px; color:var(--muted) }

    .progress{ height:8px; border-radius:999px; background:#e5e7eb; overflow:hidden; margin-top:6px; }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg, var(--brand), var(--brand-2)); transition: width .2s ease; }

    .section-title{ margin: 10px 0 0 0; font-size:14px; letter-spacing:.25px; color:var(--muted); }

    .table-wrap{ padding:0 18px 18px; }
    table{ width:100%; border-collapse: collapse; overflow:hidden; border-radius:12px; border:1px solid var(--border); }
    thead th{ font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); background:#f9fafb; }
    th, td{ text-align:left; padding:12px 14px; border-bottom:1px solid var(--border); }
    tbody tr:nth-child(even){ background: var(--table-stripe); }
    tbody a{ color:var(--brand); text-decoration:none; font-weight:600; }

    .status{ font-size:13px; margin-left:6px; }

    .pill{ padding: 6px 10px; border-radius:999px; border:1px solid var(--border); font-size:12px; color:var(--muted); }

    .footer{ padding:14px 18px; border-top:1px solid var(--border); display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }

    /* toast */
    .toast{ position: fixed; inset:auto 20px 20px auto; background: var(--card); border:1px solid var(--border); color:var(--text); padding:12px 14px; border-radius:12px; box-shadow: var(--shadow); transform: translateY(20px); opacity:0; pointer-events:none; transition: all .25s ease; }
    .toast.show{ opacity:1; transform: translateY(0); pointer-events:auto; }
    .toast.ok{ border-color: rgba(16,185,129,.45) }
    .toast.err{ border-color: rgba(239,68,68,.45) }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <div class="title">
        <div class="logo">UP</div>
        <div>
          <h1>Upload files into the Docker container</h1>
          <p class="subtitle">Files are stored at <code>/app/uploads</code> inside the container.</p>
        </div>
      </div>
      <button class="btn" id="refreshBtn" aria-label="Refresh file list">↻ Refresh</button>
    </div>

    <div class="card">
      <div class="toolbar">
        <label for="fileInput" class="btn">Choose files</label>
        <input type="file" id="fileInput" class="file-input" name="files" multiple />
        <button class="btn primary" id="uploadBtn">Upload</button>
        <span class="status muted" id="status">Idle</span>
        <span class="pill" id="countPill">0 selected</span>
      </div>

      <div class="uploader">
        <div class="dropzone" id="dropzone" tabindex="0" role="button" aria-label="Drop files here or click to select">
          <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 16V8m0 0l-3 3m3-3l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 16.5a4.5 4.5 0 00-4.5-4.5H15A6 6 0 103 12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="dz-title">Drag & drop files here</div>
          <div class="dz-sub">or click to browse — max size depends on server</div>
        </div>

        <div>
          <div class="section-title">Selected files</div>
          <div class="queue" id="queue">
            <div class="empty">No files selected yet.</div>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <div class="section-title">Files in container</div>
        <table id="filesTable" aria-live="polite">
          <thead>
            <tr><th>Name</th><th>Size</th><th>Modified</th><th>Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="footer">
        <span class="muted">Tip: Open files via the link; use <code>Download</code> to save locally.</span>
        <span class="muted" id="lastUpdated">Last updated —</span>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="assertive"></div>

  <script>
    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));

    const fileInput = $('#fileInput');
    const queueEl = $('#queue');
    const countPill = $('#countPill');
    const statusEl = $('#status');
    const lastUpdated = $('#lastUpdated');
    const toast = $('#toast');

    const fmtBytes = (n) => {
      if (n === 0) return '0 B';
      const units = ['B','KB','MB','GB','TB'];
      let i = Math.floor(Math.log(n) / Math.log(1024));
      const v = (n / Math.pow(1024, i));
      return `${v.toFixed(v < 10 ? 1 : 0)} ${units[i]}`;
    };

    const fmtDate = (d) => new Date(d).toLocaleString();

    const showToast = (msg, type = 'ok') => {
      toast.textContent = msg; toast.className = 'toast show ' + type; 
      setTimeout(() => toast.classList.remove('show'), 2400);
    };

    const setQueue = (files) => {
      queueEl.innerHTML = '';
      if (!files.length){
        queueEl.innerHTML = '<div class="empty">No files selected yet.</div>';
        countPill.textContent = '0 selected';
        return;
      }
      files.forEach((f) => {
        const row = document.createElement('div');
        row.className = 'qitem';
        const th = document.createElement('div'); th.className = 'thumb';
        if (f.type.startsWith('image/')){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(f); th.appendChild(img);
        } else {
          th.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M7 3h6l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" stroke="currentColor" stroke-width="1.5"/><path d="M13 3v5h5" stroke="currentColor" stroke-width="1.5"/></svg>';
        }
        const info = document.createElement('div');
        info.innerHTML = `<div class="name">${f.name}</div><div class="meta">${fmtBytes(f.size)} · ${f.type || 'unknown'}</div><div class="progress"><div class="bar" data-name="${encodeURIComponent(f.name)}"></div></div>`;
        const act = document.createElement('div'); act.innerHTML = '<span class="pill">Queued</span>';
        row.append(th, info, act); queueEl.appendChild(row);
      });
      countPill.textContent = files.length + (files.length === 1 ? ' selected' : ' selected');
    };

    // Drag & Drop
    const dz = $('#dropzone');
    ;['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.add('drag'); }));
    ;['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dz.classList.remove('drag'); }));
    dz.addEventListener('drop', (e)=>{ const files = e.dataTransfer.files; fileInput.files = files; setQueue(files); });
    dz.addEventListener('click', ()=> fileInput.click());

    // Input change
    fileInput.addEventListener('change', (e)=> setQueue(e.target.files));

    // Upload
    const upload = async () => {
      const files = fileInput.files; if (!files.length) { showToast('Please choose at least one file', 'err'); return; }
      const fd = new FormData(); Array.from(files).forEach((f)=> fd.append('files', f));
      statusEl.textContent = 'Uploading…';

      // Use XHR for progress
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');
      xhr.upload.onprogress = (e) => {
        if (!e.lengthComputable) return;
        const pct = Math.round((e.loaded / e.total) * 100);
        $$('.bar').forEach(b => b.style.width = pct + '%');
      };
      xhr.onreadystatechange = () => {
        if (xhr.readyState === 4){
          if (xhr.status >= 200 && xhr.status < 300){
            try { const json = JSON.parse(xhr.responseText); statusEl.textContent = `Uploaded ${json.uploaded?.length ?? 0} file(s).`; showToast('Upload complete'); refresh(); }
            catch{ statusEl.textContent = 'Uploaded.'; showToast('Upload complete'); refresh(); }
          } else { statusEl.textContent = 'Error uploading files.'; showToast('Upload failed', 'err'); }
        }
      };
      xhr.send(fd);
    };

    $('#uploadBtn').addEventListener('click', (e)=>{ e.preventDefault(); upload(); });

    async function refresh(){
      try{
        const res = await fetch('/files');
        if(!res.ok) throw new Error('Failed to fetch file list');
        const data = await res.json();
        const tbody = document.querySelector('#filesTable tbody');
        tbody.innerHTML = '';
        for (const f of data){
          const tr = document.createElement('tr');

          const nameTd = document.createElement('td');
          const link = document.createElement('a'); link.href = `/uploads/${encodeURIComponent(f.name)}`; link.textContent = f.name; link.target = '_blank'; nameTd.appendChild(link);

          const sizeTd = document.createElement('td'); sizeTd.textContent = fmtBytes(f.size || 0);

          const mTd = document.createElement('td'); mTd.textContent = fmtDate(f.mtime);

          const aTd = document.createElement('td');
          const dl = document.createElement('a'); dl.href = `/download/${encodeURIComponent(f.name)}`; dl.textContent = 'Download'; aTd.appendChild(dl);

          tr.append(nameTd, sizeTd, mTd, aTd);
          tbody.appendChild(tr);
        }
        lastUpdated.textContent = 'Last updated — ' + new Date().toLocaleTimeString();
      }catch(e){ showToast('Could not refresh file list', 'err'); }
    }

    $('#refreshBtn').addEventListener('click', ()=> refresh());

    // Initial load
    refresh();
  </script>
</body>
</html>
